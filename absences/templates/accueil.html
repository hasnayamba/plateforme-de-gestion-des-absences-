{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des Absences - Accueil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <!-- Barre de navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand">Plateforme de Gestion des Absences</span>
            <div class="d-flex">
                <a href="/login/" class="btn btn-outline-light">Se connecter</a>
            </div>
        </div>
    </nav>

<div class="container mt-4">

  <h3 class="mb-4 text-center">üìÖ Tableau r√©capitulatif des absences et r√©cup√©rations</h3>
  <table class="table table-bordered table-striped table-hover align-middle">
    <thead class="table-dark text-center">
      <tr>
        <th>Collaborateur</th>
        {% for mois in mois_noms %}
          <th>{{ mois }}</th>
        {% endfor %}
        
      </tr>
    </thead>

    <tbody>
      {% for ligne in lignes %}
        <tr>
          <td class="fw-bold">{{ ligne.user.get_full_name }}</td>

          {% for abs_mois in ligne.mois %}
            <td class="text-center">
              {% if abs_mois %}
                {% for absence in abs_mois %}
                  
                  {% if absence.obj_type == "Absence" %}
                    {% if absence.statut == "approuve_superieur" %}
                      <span class="badge bg-primary text-white d-block mb-1">
                        {{ absence.type_absence.nom }}<br>
                        ({{ absence.date_debut|date:"d/m" }} ‚Üí {{ absence.date_fin|date:"d/m" }})
                      </span>

                    {% elif absence.statut == "verifie_drh" %}
                      <span class="badge bg-warning text-dark d-block mb-1">
                        {{ absence.type_absence.nom }}<br>
                        ({{ absence.date_debut|date:"d/m" }} ‚Üí {{ absence.date_fin|date:"d/m" }})
                      </span>

                    {% elif absence.statut == "valide_dp" %}
                      <span class="badge bg-success text-white d-block mb-1">
                        {{ absence.type_absence.nom }}<br>
                        ({{ absence.date_debut|date:"d/m" }} ‚Üí {{ absence.date_fin|date:"d/m" }})
                      </span>
                    {% endif %}
                  
                  {% elif absence.obj_type == "Recuperation" and absence.statut == "valide" %}
                    <span class="badge bg-info text-dark d-block mb-1">
                      R√©cup√©ration<br>
                      ({{ absence.date_debut|date:"d/m" }} ‚Üí {{ absence.date_fin|date:"d/m" }})
                    </span>

                  {% elif absence.obj_type == "Recuperation" and absence.statut == "verifie_drh" %}
                    <span class="badge bg-secondary text-dark d-block mb-1">
                      R√©cup√©ration<br>
                      ({{ absence.date_debut|date:"d/m" }} ‚Üí {{ absence.date_fin|date:"d/m" }})
                    </span>
                  {% endif %}

                {% endfor %}
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>
          {% endfor %}

        </tr>
      {% empty %}
        <tr>
          <td colspan="14" class="text-center text-muted">Aucune absence ni r√©cup√©ration √† afficher.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<!-- üü¶ L√©gende -->
  <div class="mb-3 text-center">
    <span class="badge bg-warning text-dark me-2">V√©rifi√© par RH</span>
    <span class="badge bg-primary text-white me-2">Approuv√© par Sup√©rieur</span>
    <span class="badge bg-success text-white me-2">Valid√© par DP</span>
    <span class="badge bg-secondary text-dark">R√©cup√©ration valid√©e RH</span>
    <span class="badge bg-info text-dark">R√©cup√©ration valid√©e</span>
  </div>

</body>
</html>
